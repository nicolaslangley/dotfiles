# Initialize Zsh completion system and harden permissions
autoload -Uz compinit && compinit
# Harden permissions - skip chmod on Windows as it doesn't support symbolic permissions
if [[ "$OSTYPE" != "msys" && "$OSTYPE" != "cygwin" ]]; then
  compaudit | xargs chmod go-w 2>/dev/null  # Remove group/other write perms to prevent injection
fi

# Dotfiles export
DOTFILES_DIR=$HOME/Developer/dotfiles
export DOTFILES_DIR

export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="arrow"
plugins=(git)
source $ZSH/oh-my-zsh.sh

# Detect platform and load platform-specific configs
if [[ "$OSTYPE" == "darwin"* ]]; then
  # macOS
  source $DOTFILES_DIR/zsh/path-macos.sh
  source $DOTFILES_DIR/zsh/environment-macos.sh
elif [[ "$OSTYPE" == "msys" || "$OSTYPE" == "cygwin" ]]; then
  # Windows (Git Bash)
  source $DOTFILES_DIR/zsh/path-windows.sh
  source $DOTFILES_DIR/zsh/environment-windows.sh
fi

# Speed up prompt with large repos
DISABLE_UNTRACKED_FILES_DIRTY="true"
